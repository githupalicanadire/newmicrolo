@page
@model Shopping.Web.Pages.ProductListModel
@{
    ViewData["Title"] = "Products";
}

<div class="container py-4">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-gradient-primary rounded p-3 mb-0 shadow-sm">
            <li class="breadcrumb-item"><a asp-page="Index" class="text-white text-decoration-none"><i class="fas fa-home me-1"></i>Home</a></li>
            <li class="breadcrumb-item"><a asp-page="ProductList" class="text-white text-decoration-none">Products</a></li>
            @if (!string.IsNullOrEmpty(Model.SelectedCategory))
            {
                <li class="breadcrumb-item active text-white" aria-current="page">@Model.SelectedCategory</li>
            }
        </ol>
    </nav>

    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3">
            <!-- Categories -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Categories</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a asp-page="ProductList" asp-route-page="1"
                       class="list-group-item list-group-item-action @(string.IsNullOrEmpty(Model.SelectedCategory) ? "active" : "")">
                        <i class="fas fa-th-large me-2"></i>All Products
                    </a>
                    @foreach (var category in Model.CategoryList)
                    {
                        <a asp-page="ProductList"
                           asp-route-categoryName="@category"
                           asp-route-page="1"
                           class="list-group-item list-group-item-action @(category == Model.SelectedCategory ? "active" : "")">
                            <i class="fas fa-tag me-2"></i>@category
                        </a>
                    }
                </div>
            </div>

            <!-- Last Product -->
            @if (Model.ProductList.Any())
            {
                var lastProduct = Model.ProductList.Last();
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-gradient-success text-white">
                        <h5 class="mb-0"><i class="fas fa-star me-2"></i>Latest Product</h5>
                    </div>
                    <div class="card-body">
                        <div class="position-relative mb-3">
                            <img asp-append-version="true" class="img-fluid rounded" src="@lastProduct.ImageFile" alt="@lastProduct.Name" />
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge bg-gradient-primary">New</span>
                            </div>
                        </div>
                        <h6 class="card-title">@lastProduct.Name</h6>
                        <p class="card-text small">@lastProduct.Description</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="h5 mb-0 text-primary">@lastProduct.Price TL</span>
                            <a asp-page="ProductDetail" asp-route-productId="@lastProduct.Id" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Products Grid -->
        <div class="col-lg-9">
            @if (!Model.ProductList.Any())
            {
                <div class="alert shadow-sm" style="background: rgba(76,175,80,0.1); color: var(--primary-color);">
                    <i class="fas fa-info-circle me-2"></i>No products found.
                </div>
            }
            else
            {
                <div class="row g-4">
                    @foreach (var product in Model.ProductList)
                    {
                        <div class="col-sm-6 col-md-4 col-lg-3">
                            <partial name="_ProductItemPartial" model="@product" />
                        </div>
                    }
                </div>

                <!-- Modern Pagination -->
                @if (Model.TotalPages > 1)
                {
                    <nav aria-label="Product pagination" class="mt-5">
                        <div class="modern-pagination">
                            <div class="pagination-info">
                                <span class="pagination-text">
                                    Page @Model.CurrentPage of @Model.TotalPages
                                </span>
                            </div>
                            <div class="pagination-controls">
                                @if (Model.CurrentPage > 1)
                                {
                                    <a asp-page="ProductList"
                                       asp-route-categoryName="@Model.SelectedCategory"
                                       asp-route-page="@(Model.CurrentPage - 1)"
                                       class="pagination-btn pagination-prev">
                                        <i class="fas fa-chevron-left"></i>
                                        <span>Previous</span>
                                    </a>
                                }

                                <div class="pagination-numbers">
                                    @{
                                        int startPage = Math.Max(1, Model.CurrentPage - 2);
                                        int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                                    }

                                    @if (startPage > 1)
                                    {
                                        <a asp-page="ProductList"
                                           asp-route-categoryName="@Model.SelectedCategory"
                                           asp-route-page="1"
                                           class="pagination-number">1</a>
                                        @if (startPage > 2)
                                        {
                                            <span class="pagination-dots">...</span>
                                        }
                                    }

                                    @for (int i = startPage; i <= endPage; i++)
                                    {
                                        <a asp-page="ProductList"
                                           asp-route-categoryName="@Model.SelectedCategory"
                                           asp-route-page="@i"
                                           class="pagination-number @(i == Model.CurrentPage ? "active" : "")">
                                            @i
                                        </a>
                                    }

                                    @if (endPage < Model.TotalPages)
                                    {
                                        @if (endPage < Model.TotalPages - 1)
                                        {
                                            <span class="pagination-dots">...</span>
                                        }
                                        <a asp-page="ProductList"
                                           asp-route-categoryName="@Model.SelectedCategory"
                                           asp-route-page="@Model.TotalPages"
                                           class="pagination-number">@Model.TotalPages</a>
                                    }
                                </div>

                                @if (Model.CurrentPage < Model.TotalPages)
                                {
                                    <a asp-page="ProductList"
                                       asp-route-categoryName="@Model.SelectedCategory"
                                       asp-route-page="@(Model.CurrentPage + 1)"
                                       class="pagination-btn pagination-next">
                                        <span>Next</span>
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                }
                            </div>
                        </div>
                    </nav>
                }
            }
        </div>
    </div>
</div>
